name: find marvin dependencies

on:
    workflow_dispatch: # Allows manual triggering of the workflow
    schedule:
        - cron: '0 0 * * *'  # Runs every day at midnight

jobs:
    find-dependencies:
        runs-on: ubuntu-latest
        permissions:
            contents: write
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                token: ${{ secrets.GITHUB_TOKEN }}

            - name: download syft
              run: curl -sSfL https://get.anchore.io/syft | sudo sh -s -- -b /usr/local/bin

            - name: find dependencies
              run: syft -q epitechcontent/epitest-docker:latest -o table > dependencies.txt

            - name: config git
              run: |
                git config --global user.name "github-actions"
                git config --global user.email "guillaume.matton@epitech.eu"

            - name: commit dependencies
              run: |
                git add dependencies.txt
                git commit -m "New dependencies found (or first run) on: $(date -u +'%d-%m-%Y')" || echo "No changes to commit"
                git push
